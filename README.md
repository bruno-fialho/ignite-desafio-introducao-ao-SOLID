<!-- <p align="right">
  <a href="README.en.md">üá∫üá∏</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
  <a href="README.md">üáßüá∑</a>&nbsp;&nbsp;&nbsp;
</p> -->

<img alt="Ignite" src=./src/assets/header-ignite.png />

<h2 align="center">
  Desafio 04 - Introdu√ß√£o ao SOLID
</h2>
<h3 align="center">
  Bootcamp Ignite Node.js 2021 - <a href="https://rocketseat.com.br/">Rocketseat</a>
</h3>

<p align="center">
  <a href="#computer-sobre-a-aplica√ß√£o">Sobre a aplica√ß√£o</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
  <a href="#warning-testes">Testes</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
  <a href="#cd-pacotes-instalados">Pacotes instalados</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
  <a href="#memo-licen√ßa">Licen√ßa</a>
</p>

## :computer: Sobre a aplica√ß√£o

Essa¬†√©¬†uma¬†aplica√ß√£o¬†de listagem e cadastro de usu√°rios. Para que a listagem de usu√°rios funcione, o usu√°rio que solicita a listagem deve ser um admin.

### :link: Instru√ß√µes para clonar reposit√≥rio

Para rodar a aplica√ß√£o na sua m√°quina:

1. `git clone https://github.com/bruno-fialho/ignite-desafio-introducao-ao-SOLID`

2. Na pasta do reposit√≥rio, rodar um `yarn` para instalar as depend√™ncias.

### Rotas da aplica√ß√£o

A aplica√ß√£o tem as seguintes rotas:

- POST `/users`: A rota deve receber `name`, e `email` dentro do corpo da requisi√ß√£o para que seja poss√≠vel cadastrar um usu√°rio.

- PATCH `/users/:user_id/admin`: A rota deve receber, nos par√¢metros da rota, o `id` de um usu√°rio e transformar esse usu√°rio em admin.

- GET `/users/:user_id`: A rota deve receber, nos par√¢metros da rota, o `id` de um usu√°rio e devolver as informa√ß√µes do usu√°rio encontrado pelo corpo da resposta.

- GET `/users`: A rota deve receber, pelo header da requisi√ß√£o, uma propriedade `user_id` contendo o `id` do usu√°rio e retornar uma lista com todos os usu√°rios cadastrados. O `id` dever√° ser usado para validar se o usu√°rio que est√° solicitando a listagem √© um admin. O retorno da lista deve ser feito apenas se o usu√°rio for admin.

## :warning: Testes

Para esse desafio, temos os seguintes testes:

### Teste do model

- **Should be able to create an user with all props**

    Para que esse teste passe, voc√™ deve completar o c√≥digo do model de usu√°rios que est√° em **src/modules/users/model/User.ts**.
    O usu√°rio deve ter as seguintes propriedades:

```json
{
  "id": "string",

  "name": "string",
  
  "admin": "boolean",

  "email": "string",

  "created_at": "Date",

  "updated_at": "Date",
}
```

### Testes do reposit√≥rio

- **Should be able to create new users**

    Para que esse teste passe, √© necess√°rio que o m√©todo `create` do arquivo **src/modules/users/repositories/implementations/UsersRepository** permita receber o `name` e `email` de um usu√°rio, crie um usu√°rio a partir do model (que foi completado no teste anterior).

- **Should be able to list all users**

    Para que esse teste passe, √© necess√°rio que o m√©todo `list` do arquivo **src/modules/users/repositories/implementations/UsersRepository** retorne a lista de todos os usu√°rios cadastrados na aplica√ß√£o.

- **Should be able to find user by ID**

    Para que esse teste passe, √© necess√°rio que o m√©todo `findById` do arquivo **src/modules/users/repositories/implementations/UsersRepository** receba o `id` de um usu√°rio e retorne o usu√°rio que possui o mesmo `id`.

- **Should be able to find user by e-mail address**

    Para que esse teste passe, √© necess√°rio que o m√©todo `findByEmail` do arquivo **src/modules/users/repositories/implementations/UsersRepository** receba o `email` de um usu√°rio e retorne o usu√°rio que possui o mesmo `email`.

- **Should be able to turn an user as admin**

    Para que esse teste passe, √© necess√°rio que o m√©todo `turnAdmin` do arquivo **src/modules/users/repositories/implementations/UsersRepository** receba o objeto do usu√°rio completo, mude a propriedade `admin` para `true`, atualize tamb√©m a propriedade `updated_at`  e retorne o usu√°rio atualizado.

### Testes de useCases

- **Should be able to create new users**

    Para que esse teste passe, √© necess√°rio que o m√©todo `execute` do arquivo **src/modules/users/useCases/createUser/CreateUserUseCase.ts** receba `name` e `email` do usu√°rio a ser criado, crie o usu√°rio atrav√©s do m√©todo `create` do reposit√≥rio e retorne o usu√°rio criado.

- **Should not be able to create new users when email is already taken**

    Para que esse teste passe, √© necess√°rio que o m√©todo `execute` do arquivo **src/modules/users/useCases/createUser/CreateUserUseCase.ts** n√£o permita que um usu√°rio seja criado caso j√° exista um usu√°rio com o mesmo email e, nesse caso, lance um erro no seguinte formato:

    ```tsx
    throw new Error("Mensagem do erro");
    ```

- **Should be able to turn an user as admin**

    Para que esse teste passe, √© necess√°rio que o m√©todo `execute` do arquivo **src/modules/users/useCases/turnUserAdmin/TurnUserAdminUseCase.ts** receba o `id` de um usu√°rio, chame o m√©todo do reposit√≥rio que transforma esse usu√°rio em administrador e retorne o usu√°rio ap√≥s a altera√ß√£o.

- **Should not be able to turn a non existing user as admin**

    Para que esse teste passe, √© necess√°rio que o m√©todo `execute` do arquivo **src/modules/users/useCases/turnUserAdmin/TurnUserAdminUseCase.ts** n√£o permita que um usu√°rio que n√£o existe seja transformado em admin. Caso o usu√°rio n√£o exista, lance um erro no seguinte formato:

    ```tsx
    throw new Error("Mensagem do erro");
    ```

- **Should be able to get user profile by ID**

    Para que esse teste passe, √© necess√°rio que o m√©todo `execute` do arquivo **src/modules/users/useCases/showUserProfile/ShowUserProfileUseCase.ts** receba o `id` de um usu√°rio, chame o m√©todo do reposit√≥rio que busca um usu√°rio pelo `id` e retorne o usu√°rio encontrado.

- **Should not be able to show profile of a non existing user**

    Para que esse teste passe, √© necess√°rio que o m√©todo `execute` do arquivo **src/modules/users/useCases/showUserProfile/ShowUserProfileUseCase.ts** n√£o permita que um usu√°rio que n√£o existe seja retornado. Caso o usu√°rio n√£o exista, lance um erro no seguinte formato:

    ```tsx
    throw new Error("Mensagem do erro");
    ```

- **Should be able to list all users**

    Para que esse teste passe, √© necess√°rio que o m√©todo `execute` do arquivo **src/modules/users/useCases/listAllUsers/ListAllUsersUseCase.ts** receba o `id` de um usu√°rio, chame o m√©todo do reposit√≥rio que retorna todos os usu√°rios cadastrados e retorne essa informa√ß√£o.

- **Should not be able to a non admin user get list of all users**

    Para que esse teste passe, √© necess√°rio que o m√©todo `execute` do arquivo **src/modules/users/useCases/listAllUsers/ListAllUsersUseCase.ts** n√£o permita que um usu√°rio que n√£o seja admin, acesse a listagem de usu√°rios cadastrados na aplica√ß√£o. Caso o usu√°rio n√£o seja admin, lance um erro no seguinte formato:

    ```tsx
    throw new Error("Mensagem do erro");
    ```

- **Should not be able to a non existing user get list of all users**

    Para que esse teste passe, √© necess√°rio que o m√©todo `execute` do arquivo **src/modules/users/useCases/listAllUsers/ListAllUsersUseCase.ts** n√£o permita que um usu√°rio que n√£o exista, acesse a listagem de usu√°rios cadastrados na aplica√ß√£o. Caso o usu√°rio n√£o exista, lance um erro no seguinte formato:

    ```tsx
    throw new Error("Mensagem do erro");
    ```

### Testes das rotas

- **Rota - [POST] /users**
  - **Should be able to create new users**

    Para que esse teste passe, usando o useCase apropriado, voc√™ deve permitir que a rota crie um usu√°rio e retorne um status `201` junto ao objeto do usu√°rio criado.

  - **Should not be able to create new users when email is already taken**

    Para que esse teste passe, caso algum erro tenha acontecido no useCase, retorne a resposta com status `400` e um json com um objeto `{ error: "mensagem do erro" }`, onde o valor da propriedade `error` deve ser a mensagem lan√ßada pelo erro no useCase.

    Para capturar erros lan√ßados por outros arquivos, voc√™ pode envolver o conte√∫do do controller em um `try/catch` e acessar a propriedade `message` do erro recebido pelo `catch`

- **Rota - [PATCH] /users/:user_id/admin**
  - **Should be able to turn an user as admin**

    Para que esse teste passe, usando o useCase apropriado, voc√™ deve permitir que a rota mude um usu√°rio padr√£o para um admin e retorne o usu√°rio alterado no corpo da resposta.

  - **Should not be able to turn a non existing user as admin**

    Para que esse teste passe, caso algum erro tenha acontecido no useCase, retorne a resposta com status `404` e um json com um objeto `{ error: "mensagem do erro" }`, onde o valor da propriedade `error` deve ser a mensagem lan√ßada pelo erro no useCase.

- **Rota - [GET] /users/:user_id**
  - **Should be able to get user profile by ID**

    Para que esse teste passe, usando o useCase apropriado, voc√™ deve permitir que a rota receba o `id` de um usu√°rio pelo par√¢metro na rota e retorne, no corpo da resposta, o objeto do usu√°rio encontrado.

  - **Should not be able to show profile of a non existing user**

    Para que esse teste passe, caso algum erro tenha acontecido no useCase, retorne a resposta com status `404` e um json com um objeto `{ error: "mensagem do erro" }`, onde o valor da propriedade `error` deve ser a mensagem lan√ßada pelo erro no useCase.

- **Rota - [GET] /users**
  - **Should be able to list all users**

    Para que esse teste passe, usando o useCase apropriado, voc√™ deve permitir que a rota receba o `id` de um usu√°rio **admin** pelo header `user_id` da requisi√ß√£o e retorne, no corpo da resposta, a lista dos usu√°rios cadastrados.

  - **Should not be able to a non admin user get list of all users**

    **Should not be able to a non existing user get list of all users**

    Para que **esses dois testes** passem, caso algum erro tenha acontecido no useCase, retorne a resposta com status `400` e um json com um objeto `{ error: "mensagem do erro" }`, onde o valor da propriedade `error` deve ser a mensagem lan√ßada pelo erro no useCase.

## :cd: Pacotes instalados

A seguir segue uma lista dos pacotes instalados:

- [express](https://www.npmjs.com/package/express)
- [uuid](https://github.com/uuidjs/uuid)
- [swagger](https://github.com/scottie1984/swagger-ui-express)
- [jest](https://jestjs.io/docs/en/getting-started)
- [supertest](https://www.npmjs.com/package/supertest)
- [typescript](https://www.typescriptlang.org/)
- [ts-node-dev](https://github.com/wclr/ts-node-dev#readme)
- [ts-jest](https://kulshekhar.github.io/ts-jest)
- [eslint](https://eslint.org/)
- [prettier](https://prettier.io/)
- [eslint-import-resolver-typescript](https://github.com/alexgorbatchev/eslint-import-resolver-typescript#readme)


## :memo: Licen√ßa

Esse projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.